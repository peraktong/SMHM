\documentclass[ajp]{article}   	% use "amsart" instead of "article" for AMSLaTeX format
\usepackage{geometry}                		% See geometry.pdf to learn the layout mixions. There are lots.

\geometry{letterpaper}                   		% ... or a4paper or a5paper or ... 
%\geometry{landscape}                		% Activate for rotated page geometry
%\usepackage[parfill]{parskip}    		% Activate to begin paragraphs with an empty line rather than an indent
\usepackage{graphicx}				% Use pdf, png, jpg, or epsÂ§ with pdflatex; use eps in DVI mode
								% TeX will automatically convert eps --> pdf in pdflatex		
\usepackage{amssymb}
\usepackage{amsmath, amsthm, amssymb, amsfonts}

\usepackage{dcolumn}% Align table columns on decimal point
\usepackage{bm}% bold math

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{authblk}

\usepackage{amsmath}

\bibliographystyle{abbrv}


%SetFonts

%SetFonts


\title{Constrain scatter by using a new $f_{con}$}
\author[1]{Jason Cao\thanks{jc6933@nyu.edu}}
\author[2]{Jeremy L.Tinker\thanks{jlt12@nyu.edu}}

\affil[1]{Department of Physics,  New York University}
\affil[2]{Center for Cosmology and Particle Physics, Department of Physics, New York University, New York, 10012 NY, USA}

\date{}							% Activate to display a given date or no date

\begin{document}
\maketitle


\section{Ideas}

Here we use a $f_{con}$ with 2 regimes. Then we derive the best fitting values of the parameters in $f_{con}$ by using scipy without adding the constraint that scatter is smaller than 0.2 at z=0. After that, apply the MCMC method and calculate the scatter of each step and walker in the chain. There will be some sets of parameters with scatters < 0.2 at z=0. Choose these sets and find the one with the smallest chi-squared. Use this set of parameters as the initial values for the scipy fitting with constraint. Re-do the scipy fitting and find the best fitting model under the constraint. Finally, plot $M_*$ vs expansion factor for all Halos.

\section{Details}

\subsection{Formula}

% log f_con = log(f0) + A1*log(M_halo[z]/Mh_threshold) + A2*log(M_star[z]/Ms_threshold) + A3*log(1+z)
The formula is split into two regimes: \cite{tinker2016testing}
\bigskip

For $z>1$
\begin{equation}
log[f_{con}(z,M_h, M_*)] = log(f_0) + A_1 \cdot log[{{M_h(z)} \over{M_h^{thr}}}]+ A_2 \cdot log[{{M_*(z)} \over{M_*^{thr}}}] + A_3 \cdot log[1+z]
\end{equation}
\bigskip

For $z<1$
\begin{equation}
log[f_{con}(z,M_h, M_*)] = log(f_0) + A_1 \cdot log[{{M_h(z=1)} \over{M_h^{thr}}}]+ A_2 \cdot log[{{M_*(z=1)} \over{M_*^{thr}}}] + A_3 \cdot log[1+1]
\end{equation}
\bigskip

The explanation of this formula is: We have an initial Baryon conversion function $f_0$. The second and the third term describe the influence of halo mass and stellar mass. I also add $M_h^{thr}$ and $M_*^{thr}$, which are the "threshold" values of halo mass and stellar mass. The reason is simple: We want to eliminate the offset term in $log(f_{con})$. If we do not eliminate this offset, it will influence the values of other terms prominently and they do have physical meanings. This won't be good. Thus, I add these terms.
But in my fitting, I fixed them at $10^{10}$ to reduce the number of variables. 

Also, at small z, which means the $f_{con}$ will almost be a constant, we fix it to be the value of formula 1 at z=1, which is useful.


\subsection{Results without the constraint that $\sigma log[M_*](z=0) <0.2$ for $log[M_h]=12$}
The best fitting model:

\begin{center}
\includegraphics[width=170mm]{brain_storm_emcee_M12.png}

\centerline{Stellar mass vs expansion factor without the constraint for $log[M_h]=12$}
\end{center}

$f_0$ = 0.355, $A_1$ = 1.062, $A_2$ = 0.995, $A_3$ = -6.265

\bigskip


Results from MCMC chain\cite{foreman2013emcee} is:
$f_0=0.378^{+0.241}_{-0.168}$, $A_1=1.170^{+0.710}_{-0.524}$, $A_2=0.194^{+0.247}_{-0.116}$, $A_3 = -9.149^{+3.538}_{-4.029}$


\subsection{Results without the constraint that $\sigma log[M_*](z=0) <0.2$ for $log[M_h]=11$}
The best fitting model:

\begin{center}
\includegraphics[width=170mm]{brain_storm_emcee_M11.png}

\centerline{Stellar mass vs expansion factor without the constraint for $log[M_h]=11$}
\end{center}

$f_0$ = 0.406, $A_1$ = 0.023, $A_2$ = -0.036, $A_3$ = -3.041

\bigskip


Results from MCMC chain is:
$f_0=1.538^{+3.519}_{-1.309}$, $A_1=-0.431^{+0.876}_{-1.920}$, $A_2=0.662^{+ 0.421}_{-0.286}$, $A_3 = -8.618^{+5.418}_{-4.570}$

%%%%%%%%% 3d plot of the MCMC chain:

\subsection{3D plot of the results from the MCMC for $log[M_h]=12$}


\begin{center}
\includegraphics[width=170mm]{emcee_M12_3d.png}

\centerline{Stellar mass vs expansion factor without the constraint for $log[M_h]=12$}
\end{center}


\subsection{3D plot of the results from the MCMC for $log[M_h]=11$}

\begin{center}
\includegraphics[width=170mm]{emcee_M11_3d.png}

\centerline{Stellar mass vs expansion factor without the constraint for $log[M_h]=11$}
\end{center}




%%%%%% With constraint:

The initial values of the parameters with constraint is found by using the MCMC: Use parameters from MCMC with scatter <0.2 as initial values. Choose one parameter set with the smallest chi-squared as the initial values. Then fit the model under the constraint by using the scipy package.

\subsection{Results with the constraint that $\sigma log[M_*](z=0) <0.2$ for $log[M_h]=12$}
The new best fitting model under constraint:

\begin{center}
\includegraphics[width=170mm]{brain_storm_emcee_M12_constraint.png}

\centerline{Stellar mass vs expansion factor with the constraint that $\sigma log[M_*](z=0) <0.2$}

\end{center}

Here: $f_0$ = 0.859, $A_1$ = 0.490, $A_2$ = -2.467, $A_3$ = -12.470.



\subsection{Results with the constraint that $\sigma log[M_*](z=0) <0.2$ for $log[M_h]=11$}
The new best fitting model under constraint:

\begin{center}
\includegraphics[width=170mm]{brain_storm_emcee_M11_constraint.png}

\centerline{Stellar mass vs expansion factor with the constraint that $\sigma log[M_*](z=0) <0.2$}

\end{center}


Here: $f_0$ = 0.406, $A_1$ = 0.023, $A_2$ = -0.036, $A_3$ = -3.041.




%%% Now let's choose 10 to 20 halos and apply these parameters:

Apply these parameters to about 20 halos:

\subsection{Results with the constraint for 20 halos with $log[M_h]=12$}
The best fitting model:

\begin{center}
\includegraphics[width=170mm]{brain_storm_emcee_20_halos_M12.png}

\centerline{Stellar mass vs expansion factor with the constraint for 20 halos with $log[M_h]=12$}

\end{center}


\subsection{Results with the constraint for 20 halos with $log[M_h]=11$}
The best fitting model:

\begin{center}
\includegraphics[width=170mm]{brain_storm_emcee_20_halos_M11.png}

\centerline{Stellar mass vs expansion factor with the constraint for 20 halos with $log[M_h]=11$}

\end{center}

\section{Future}
\bigskip
Now I?m trying to eliminate these "bad news". One solution is to adjust the parameter boundary of each regime.

\bigskipMeanwhile, I?m working on a new model beyond the power law. Something like $f=f_0 \cdot A_1 \cdot e^{{Mh}\over{Mhc}}\cdot A_2 \cdot e^{{M*}\over{M*c}} \cdot (1+z)^{A3}$ \cite{behroozi2013average}
\bigskip



reference
\bibliography{citation,pubext} 

\end{document}  